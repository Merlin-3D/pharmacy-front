<div class="container-fluid page">
    <div class="d-flex page__box p-3 mt-2">Approvisionnement</div>
    <div class="page__content shadow p-3 position-relative">
        <section class="section">
            <div class="row" id="basic-table">
                <div class="col-12 col-md-4">
                    <div class="card">
                        <div class="card-content">
                            <div class="card-body">
                                <!-- <div class=" text-center justify-content-between">
                                    <a routerLink="/medicament" class="btn btn-secondary ">
                                        <i class="bi bi-backspace"></i>
                                        Retour
                                    </a>
                                    <button (click)="nouv()" class="btn btn-primary m-5 my-4 compose-btn">
                                        <i class="bi bi-plus-circle"></i>
                                        Nouveau
                                    </button>
                                </div> -->
                                <button (click)="nouv()" class="btn btn-primary btn-block my-4 compose-btn">
                                    <i class="fas fa-plus"></i>
                                    Nouveau
                                </button>
                                <!-- Table with outer spacing -->
                                <div class="mt-3 mb-4">
                                    <h4 class="card-title">Approvisionnement sur ce médicament</h4>
                                </div>
                                <div class="table-responsive">
                                    <table *ngIf="oneApprov.content.length" datatable class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Code</th>
                                                <th>Libellé</th>
                                                <th>En stock</th>
                                                <th>Edité</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let data of oneApprov.content">
    
                                                <td><span class="badge bg-primary">{{ data.code }}</span></td>
                                                <td class="text-bold-500">{{ data.medicamment.libelle }}</td>
                                                <td class="text-bold-500"><span class="badge bg-danger">{{ data.qte_stock }}</span></td>
                                                <td (click)="editer(data)" data-toggle="tooltip" data-placement="top" title="Consulter"> <button class="btn btn-info text-white"><i class="fas fa-eye"></i></button> </td>
                                            </tr>
                    
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">Informations sur le médicament</h4>
                        </div>
                        <hr>
                        <div class="card-content">
                            <div class="card-body">
                                <div class="row">
    
                                    <div class="col-md-6">
                                        <div class="form-group row align-items-center">
                                            <div class="col-lg-4 col-3">
                                                <label class="col-form-label">Libellé </label>
                                            </div>
                                            <div class="col-lg-8 col-9">
                                                <input type="text" id="first-name" class="form-control" name="fname"
                                                    placeholder="Nom médicament" [(ngModel)]="libelle.content.libelle" disabled>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group row align-items-center">
                                            <div class="col-lg-4 col-3">
                                                <label class="col-form-label">Qte en stock</label>
                                            </div>
                                            <div class="col-lg-8 col-9">
                                                <input type="text" id="last-name" class="form-control" name="fname"
                                                    placeholder="Qte en stock" [(ngModel)]="libelle.content.qte_reel" disabled>
                                            </div>
                                        </div>
                                    </div>
    
                                    <div class="col-md-6 mt-2">
                                        <div class="form-group row align-items-center">
                                            <div class="col-lg-4 col-4">
                                                <label class="col-form-label">Prix unitaire</label>
                                            </div>
                                            <div class="col-lg-8 col-8">
                                                <input type="text" id="first-name" class="form-control" name="fname"
                                                    placeholder="Prix unit" [(ngModel)]="libelle.content.p_unit" disabled>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mt-2">
                                        <div class="form-group row align-items-center">
                                            <div class="col-lg-4 col-4">
                                                <label class="col-form-label">Prix achat unitaire</label>
                                            </div>
                                            <div class="col-lg-8 col-8">
                                                <input type="text" id="last-name" class="form-control" name="fname"
                                                    placeholder="Prix achat" [(ngModel)]="libelle.content.p_achat_unit" disabled>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div class="mt-2">
                                    <h4 class="card-title">Informations sur l'approvisionnement</h4>
                                </div>
                                <form (ngSubmit)="onSubmitApprov(approvForm)" #approvForm="ngForm">
                                
                                <div class="row mt-4">
                                    <div class="alert alert-success" *ngIf="messageSuccess">Ce médicament a bien été approvisionner</div>
                                    <div class="alert alert-danger" *ngIf="messageErreur">{{ messageErreur.err }}</div>
                                    <div class="alert alert-danger" *ngIf="erreur">{{ erreur  }}</div>
      
                                        <div class="col-lg-6 col-md-12">
                                        <input type="hidden" id="first-name" class="form-control" name="medicament"
                                                placeholder="medicamment" [(ngModel)]="id_medoc">
                                                <input type="hidden" id="first-name" class="form-control" name="user"
                                                placeholder="user" [(ngModel)]="user">
                                        <div class="mb-3">
                                            <label for="formFile" class="form-label">Code</label>
                                                <input type="text" id="first-name" class="form-control" [disabled]="!new" name="code"
                                                placeholder="Code"  [(ngModel)]="code" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="formFileMultiple" class="form-label">Qte commander</label>
                                                <input type="number" id="first-name" class="form-control" name="qte_comd"
                                                placeholder="Qte cmd"  [(ngModel)]="qte_comd" [disabled]="!new" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="formFileDisabled" class="form-label" >Prix Unitaire</label>
                                                <input type="number" id="first-name" class="form-control" name="p_achat_unit"
                                                placeholder="Prix Unit" [(ngModel)]="p_achat_unit" (ngModelChange)="saverange($event)" [disabled]="!new || qte_comd==null" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="formFileSm" class="form-label">Prix total d'achat</label>
                                            <input type="number" id="first-name" class="form-control" name="p_total_achat"
                                            style="height: 50px;"  placeholder="Prix total" [(ngModel)]="p_total_achat" [disabled]="!new|| p_achat_unit==null" required>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="mb-3">
                                            <label for="formFileSm" class="form-label">Seuil de sécurité</label>
                                            <input type="number" id="first-name" class="form-control" name="stock_securite"
                                            placeholder="Seuil"  [(ngModel)]="stock_securite" [disabled]="!new" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="formFileSm" class="form-label">Date d'approvisionnement</label>
                                                <input type="date" id="first-name" class="form-control" name="date_approv"
                                                placeholder="date d'approv"  [(ngModel)]="date_approv" [disabled]="!new" required>
                                        </div>
                                        <div>
                                            <label for="formFileLg" class="form-label">Date d'expiration</label>
                                                <input type="date" id="first-name" class="form-control" name="date_exp"
                                                placeholder="date d'exp" [(ngModel)]="date_exp" [disabled]="!new" >
                                        </div>
                                        <div class="mt-5 text-center">
                                            <button *ngIf="new" type="submit" class="btn btn-lg btn-primary " [disabled]="approvForm.invalid" style="margin-right: 2px;"><i data-feather="edit"></i>
                                                <i class="fas fa-dolly"></i> Ajouter au stock</button>
                                                <a *ngIf="!new" (click)="entrer()" class="btn btn-lg btn-success"  style="margin-right: 2px;"><i data-feather="edit"></i>
                                                    <i class="fas fa-pen-square"></i> Mettre a jour le stock</a>
                                                    <a (click)="vente()" *ngIf="!new && qte_stock>=1"   class="btn btn-lg btn-danger"><i data-feather="edit"></i>
                                                        <i class="fas fa-shopping-cart"></i> Nouvelle vente</a>
                                        </div>
                                    </div>
                             
                                </div>
                            </form>
                            </div>
                            
                            <!-- Table with no outer spacing -->
                           
                        </div>
                    </div>
                    
                </div>
                <div class="card" *ngIf="!new">
                        <div class="card-body">
                            <div class="mt-2 mb-3">
                                <h4 class="card-title">Mise a jour sur un approvisionnement</h4>
                            </div>
                            <div class="table-responsive">
                                <table class="table mb-0 table-lg">
                                    <thead>
                                        <tr>
                                            <th>CODE</th>
                                            <th>Qte init</th>
                                            <th>Qte Ajouter</th>
                                            <th>Mise a jour le. a.</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr  *ngFor="let data of listEntrer.content">
                                            <td><span class="badge bg-primary">{{ data.approvisionnement.code }}</span></td>
                                            <td>{{ data.qte_stock_init }}</td>
                                            <td><span class="badge bg-danger">{{ data.qte_entree }}</span></td>
                                            <td>{{ data.createdAt | date: 'dd/MM/yyyy h:mm:ss a'  }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
            </div>
        </section>
    </div>
  </div>
  